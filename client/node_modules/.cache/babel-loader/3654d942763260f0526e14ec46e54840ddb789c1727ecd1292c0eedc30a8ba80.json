{"ast":null,"code":"import _defineProperty from\"C:/VISILAB/Hans/HANS-Platform/client/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _objectSpread from\"C:/VISILAB/Hans/HANS-Platform/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"C:/VISILAB/Hans/HANS-Platform/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{React,useRef,useState,useEffect}from\"react\";import Backdrop from'@mui/material/Backdrop';import Paper from'@mui/material/Paper';import Box from'@mui/material/Box';import Typography from'@mui/material/Typography';import CountDown from'./Countdown';import SessionStatusView from'./StatusView';import QuestionDetails from'./QuestionDetails';import BoardView from'../BoardView';import{Session,SessionStatus}from'../../context/Session';import{QuestionStatus}from'../../context/Question';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export default function SessionView(_ref){var sessionId=_ref.sessionId,participantId=_ref.participantId,_ref$onLeave=_ref.onLeave,onLeave=_ref$onLeave===void 0?function(){}:_ref$onLeave;var sessionRef=useRef(null);var _useState=useState(SessionStatus.Joining),_useState2=_slicedToArray(_useState,2),sessionStatus=_useState2[0],setSessionStatus=_useState2[1];var _useState3=useState({status:QuestionStatus.Undefined}),_useState4=_slicedToArray(_useState3,2),question=_useState4[0],setQuestion=_useState4[1];var _useState5=useState({x:0,y:0,norm:[]}),_useState6=_slicedToArray(_useState5,2),userMagnetPosition=_useState6[0],setUserMagnetPosition=_useState6[1];var _useState7=useState({}),_useState8=_slicedToArray(_useState7,2),peerMagnetPositions=_useState8[0],setPeerMagnetPositions=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),centralCuePosition=_useState10[0],setCentralCuePosition=_useState10[1];var _useState11=useState('2023-04-01T00:00:00Z'),_useState12=_slicedToArray(_useState11,2),targetDateCountdown=_useState12[0],setTargetDateCountdown=_useState12[1];useEffect(function(){window.addEventListener('beforeunload',onLeaveSessionClick);fetch(\"/api/session/\".concat(sessionId),{method:'GET',headers:{'Accept':'application/json'}}).then(function(res){if(res.status===200){res.json().then(function(data){setSessionStatus(SessionStatus.Waiting);if(data.question_id){setQuestion({status:QuestionStatus.Loading,id:data.question_id});}});}else{res.text().then(function(msg){return console.log(msg);});}}).catch(function(error){console.log(error);});sessionRef.current=new Session(sessionId,participantId,function(controlMessage){switch(controlMessage.type){case'setup':{if(controlMessage.question_id===null){setQuestion({status:QuestionStatus.Undefined});}else{setQuestion({status:QuestionStatus.Loading,id:controlMessage.question_id});}break;}case'start':{setSessionStatus(SessionStatus.Active);setTargetDateCountdown(controlMessage.targetDate+13);break;}case'started':{setSessionStatus(SessionStatus.Active);setTargetDateCountdown(controlMessage.targetDate+13);var positions=JSON.parse(controlMessage.positions);if(peerMagnetPositions.length!==0){var _loop=function _loop(participant){var usablePeerPositions=positions[participant].slice(positions[participant].indexOf('Z')+2).split(',').map(parseFloat);if(participant!==participantId){setPeerMagnetPositions(function(peerPositions){return _objectSpread(_objectSpread({},peerPositions),{},_defineProperty({},participant,usablePeerPositions));});}};for(var participant in positions){_loop(participant);}}break;}case'stop':{setSessionStatus(SessionStatus.Waiting);setUserMagnetPosition({x:0,y:0,norm:[]});setPeerMagnetPositions({});break;}default:break;}},function(participantId,updateMessage){setPeerMagnetPositions(function(peerPositions){console.log(peerPositions);return _objectSpread(_objectSpread({},peerPositions),{},_defineProperty({},participantId,updateMessage.data.position));});});},[sessionId,participantId,onLeaveSessionClick,peerMagnetPositions]);useEffect(function(){var ignore=false;if(question.status===QuestionStatus.Loading){fetch(\"/api/question/\".concat(question.id),{method:'GET',headers:{'Accept':'application/json'}}).then(function(res){if(res.status===200){res.json().then(function(data){if(!ignore){setQuestion({status:QuestionStatus.Loaded,id:data.id,prompt:data.prompt,answers:data.answers,image:\"/api/question/\".concat(data.id,\"/image\")});sessionRef.current.publishControl({type:'ready'});}});}else{res.text().then(function(msg){return console.log(msg);});}}).catch(function(error){console.log(error);});}return function(){ignore=true;};},[question]);useEffect(function(){// Update central Cue based on magnet positions\nif(peerMagnetPositions&&peerMagnetPositions.length!==0){var usablePeerPositions=Object.keys(peerMagnetPositions).map(function(k){return peerMagnetPositions[k];}).filter(function(peerPosition){return peerPosition.length===question.answers.length;});setCentralCuePosition(usablePeerPositions.reduce(function(cuePosition,peerPosition){return cuePosition.map(function(value,i){return value+peerPosition[i];});},userMagnetPosition.norm).map(function(value){return value/(1+usablePeerPositions.length);}));}},[userMagnetPosition,peerMagnetPositions,question]);// DEBUG-ONLY\n/*useEffect(() => {\r\n    // The component was drawn for the first time, configure a 1-second interval to simulate peer updates\r\n    const interval = setInterval(() => {\r\n      setPeerMagnetPositions(peerPositions => peerPositions.map(\r\n        peerPosition => \r\n          ((question.status === QuestionStatus.Loaded) && (peerPosition.length !== question.answers.length))\r\n          ? new Array(question.answers.length).fill(0).map(_ => Math.random())\r\n          : peerPosition.map(\r\n            value => Math.min(1.1, Math.max(0, value + (Math.random() - 0.5) * 0.1))\r\n          )\r\n      ));\r\n    }, 100);\r\n    return () => clearInterval(interval);\r\n  }, [question]);*/var onUserMagnetMove=function onUserMagnetMove(position){if(sessionStatus!==SessionStatus.Active)return;var sumPositions=0;for(var i=0;i<position.norm.length;i++)sumPositions+=position.norm[i];if(sumPositions>1){for(var _i=0;_i<position.norm.length;_i++)position.norm[_i]=position.norm[_i]/sumPositions;}setUserMagnetPosition(position);var tiempoTranscurrido=Date.now();var hoy=new Date(tiempoTranscurrido);sessionRef.current.publishUpdate({data:{position:position.norm,timeStamp:hoy.toISOString()}});};var onLeaveSessionClick=useCallback(function(){// TODO: User should double-check the intention to logout (showing a modal when the leave/logout button is pressed)\n// TODO: The server should be notified about the user leaving the session:\n//sessionRef.current.leave()\nfetch(\"/api/session/\".concat(sessionId,\"/participants/\").concat(participantId),{method:'POST',headers:{'Accept':'application/json','Content-Type':'application/json'}}).then(function(res){if(res.status===200){res.json().then(function(data){});}else{}}).catch(function(error){});onLeave();},[]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Backdrop,{sx:{color:'#fff',zIndex:function zIndex(theme){return theme.zIndex.drawer+1;}},open:sessionStatus!==SessionStatus.Active,children:/*#__PURE__*/_jsx(SessionStatusView,{sessionId:sessionId,sessionStatus:sessionStatus,questionStatus:question.status,onLeaveClick:onLeaveSessionClick})}),/*#__PURE__*/_jsxs(Box,{component:\"main\",height:\"100vh\",sx:{display:'flex',flexDirection:'column'},children:[/*#__PURE__*/_jsx(Paper,{component:\"header\",elevation:2,sx:{m:1,p:1,borderRadius:2},children:/*#__PURE__*/_jsx(Typography,{component:\"h1\",variant:\"h4\",textAlign:\"center\",children:question.status===QuestionStatus.Loaded?question.prompt:\"Question not defined yet\"})}),/*#__PURE__*/_jsxs(Box,{sx:{flex:1,minHeight:0,gap:'10px',m:1,display:'flex',alignItems:'stretch'},children:[/*#__PURE__*/_jsxs(Paper,{variant:\"outlined\",sx:{flex:1,/* grow: 1, shrink: 1, basis: 0*/alignSelf:'flex-start',bgcolor:'#EEEEEE',p:1},children:[/*#__PURE__*/_jsx(QuestionDetails,{image:question.status===QuestionStatus.Loaded?question.image:\"\",prompt:question.status===QuestionStatus.Loaded?question.prompt:\"Question not defined yet\"}),sessionStatus===SessionStatus.Active&&/*#__PURE__*/_jsx(CountDown,{targetDate:targetDateCountdown})]}),/*#__PURE__*/_jsx(Paper,{elevation:2,sx:{flex:2,// grow: 2, shrink: 2, basis: 0\nheight:'100%',p:1,display:'flex',flexDirection:'column'},children:/*#__PURE__*/_jsx(BoardView,{answers:question.status===QuestionStatus.Loaded?question.answers:[],centralCuePosition:centralCuePosition,peerMagnetPositions:peerMagnetPositions&&Object.keys(peerMagnetPositions).map(function(k){return peerMagnetPositions[k];}),userMagnetPosition:userMagnetPosition,onUserMagnetMove:onUserMagnetMove})})]})]})]});}","map":{"version":3,"names":["React","useRef","useState","useEffect","Backdrop","Paper","Box","Typography","CountDown","SessionStatusView","QuestionDetails","BoardView","Session","SessionStatus","QuestionStatus","SessionView","sessionId","participantId","onLeave","sessionRef","Joining","sessionStatus","setSessionStatus","status","Undefined","question","setQuestion","x","y","norm","userMagnetPosition","setUserMagnetPosition","peerMagnetPositions","setPeerMagnetPositions","centralCuePosition","setCentralCuePosition","targetDateCountdown","setTargetDateCountdown","window","addEventListener","onLeaveSessionClick","fetch","method","headers","then","res","json","data","Waiting","question_id","Loading","id","text","msg","console","log","catch","error","current","controlMessage","type","Active","targetDate","positions","JSON","parse","length","usablePeerPositions","participant","slice","indexOf","split","map","parseFloat","peerPositions","updateMessage","position","ignore","Loaded","prompt","answers","image","publishControl","Object","keys","k","filter","peerPosition","reduce","cuePosition","value","i","onUserMagnetMove","sumPositions","tiempoTranscurrido","Date","now","hoy","publishUpdate","timeStamp","toISOString","useCallback","color","zIndex","theme","drawer","display","flexDirection","m","p","borderRadius","flex","minHeight","gap","alignItems","alignSelf","bgcolor","height"],"sources":["C:/VISILAB/Hans/HANS-Platform/client/src/components/session/SessionView.jsx"],"sourcesContent":["import { React, useRef, useState, useEffect } from \"react\";\r\n\r\nimport Backdrop from '@mui/material/Backdrop';\r\n\r\nimport Paper from '@mui/material/Paper';\r\nimport Box from '@mui/material/Box';\r\nimport Typography from '@mui/material/Typography';\r\n\r\nimport CountDown from './Countdown';\r\nimport SessionStatusView from './StatusView';\r\nimport QuestionDetails from './QuestionDetails';\r\nimport BoardView from '../BoardView';\r\nimport { Session, SessionStatus } from '../../context/Session';\r\nimport { QuestionStatus } from '../../context/Question';\r\n\r\n\r\nexport default function SessionView({ sessionId, participantId, onLeave = () => { } }) {\r\n  const sessionRef = useRef(null);\r\n  const [sessionStatus, setSessionStatus] = useState(SessionStatus.Joining);\r\n  const [question, setQuestion] = useState({ status: QuestionStatus.Undefined });\r\n  const [userMagnetPosition, setUserMagnetPosition] = useState({ x: 0, y: 0, norm: [] });\r\n  const [peerMagnetPositions, setPeerMagnetPositions] = useState({});\r\n  const [centralCuePosition, setCentralCuePosition] = useState([]);\r\n  const [targetDateCountdown, setTargetDateCountdown] = useState('2023-04-01T00:00:00Z');\r\n\r\n  useEffect(() => {\r\n    window.addEventListener('beforeunload', onLeaveSessionClick);\r\n    fetch(\r\n      `/api/session/${sessionId}`,\r\n      {\r\n        method: 'GET',\r\n        headers: {\r\n          'Accept': 'application/json',\r\n        },\r\n      }\r\n    ).then(res => {\r\n      if (res.status === 200) {\r\n        res.json().then(data => {\r\n          setSessionStatus(SessionStatus.Waiting);\r\n          if (data.question_id) {\r\n            setQuestion({ status: QuestionStatus.Loading, id: data.question_id });\r\n          }\r\n        });\r\n      } else {\r\n        res.text().then(msg => console.log(msg));\r\n      }\r\n    }).catch(error => {\r\n      console.log(error);\r\n    });\r\n\r\n    sessionRef.current = new Session(sessionId, participantId,\r\n      (controlMessage) => {\r\n        switch (controlMessage.type) {\r\n          case 'setup': {\r\n            if (controlMessage.question_id === null) {\r\n              setQuestion({ status: QuestionStatus.Undefined });\r\n            } else {\r\n              setQuestion({\r\n                status: QuestionStatus.Loading,\r\n                id: controlMessage.question_id\r\n              });\r\n            }\r\n            break;\r\n          }\r\n          case 'start': {\r\n            setSessionStatus(SessionStatus.Active);\r\n            setTargetDateCountdown((controlMessage.targetDate + 13))\r\n            break;\r\n          }\r\n          case 'started': {\r\n            setSessionStatus(SessionStatus.Active);\r\n            setTargetDateCountdown((controlMessage.targetDate + 13))\r\n            let positions = JSON.parse(controlMessage.positions);\r\n            if (peerMagnetPositions.length !== 0) {\r\n              for (const participant in positions) {\r\n                let usablePeerPositions = positions[participant].slice(positions[participant].indexOf('Z') + 2).split(',').map(parseFloat);\r\n                if(participant !== participantId){\r\n                  setPeerMagnetPositions((peerPositions) => {\r\n                    return {\r\n                      ...peerPositions,\r\n                      [participant]: usablePeerPositions\r\n                    }\r\n                  });\r\n                }\r\n              }\r\n            }\r\n            break;\r\n          }\r\n          case 'stop': {\r\n            setSessionStatus(SessionStatus.Waiting);\r\n            setUserMagnetPosition({ x: 0, y: 0, norm: [] })\r\n            setPeerMagnetPositions({});\r\n            break;\r\n          }\r\n          default: break;\r\n        }\r\n      },\r\n      (participantId, updateMessage) => {\r\n        setPeerMagnetPositions((peerPositions) => {\r\n          console.log(peerPositions)\r\n          return {\r\n            ...peerPositions,\r\n            [participantId]: updateMessage.data.position\r\n          }\r\n        });\r\n      }\r\n      );\r\n  }, [sessionId, participantId, onLeaveSessionClick, peerMagnetPositions]);\r\n\r\n  useEffect(() => {\r\n    let ignore = false;\r\n    if (question.status === QuestionStatus.Loading) {\r\n      fetch(\r\n        `/api/question/${question.id}`,\r\n        {\r\n          method: 'GET',\r\n          headers: {\r\n            'Accept': 'application/json',\r\n          },\r\n        }\r\n      ).then(res => {\r\n        if (res.status === 200) {\r\n          res.json().then(data => {\r\n            if (!ignore) {\r\n              setQuestion({\r\n                status: QuestionStatus.Loaded,\r\n                id: data.id,\r\n                prompt: data.prompt,\r\n                answers: data.answers,\r\n                image: `/api/question/${data.id}/image`,\r\n              });\r\n              sessionRef.current.publishControl({ type: 'ready' });\r\n            }\r\n          });\r\n        } else {\r\n          res.text().then(msg => console.log(msg));\r\n        }\r\n      }).catch(error => {\r\n        console.log(error);\r\n      });\r\n    }\r\n    return () => { ignore = true };\r\n  }, [question]);\r\n\r\n  useEffect(() => {\r\n    // Update central Cue based on magnet positions\r\n    if (peerMagnetPositions && peerMagnetPositions.length !== 0) {\r\n      const usablePeerPositions = Object.keys(peerMagnetPositions).map(\r\n        k => peerMagnetPositions[k]\r\n      ).filter(peerPosition => peerPosition.length === question.answers.length);\r\n      setCentralCuePosition(\r\n        usablePeerPositions.reduce(\r\n          (cuePosition, peerPosition) => cuePosition.map(\r\n            (value, i) => value + peerPosition[i]\r\n          ),\r\n          userMagnetPosition.norm\r\n        ).map(value => value / (1 + usablePeerPositions.length))\r\n      );\r\n    }\r\n  }, [userMagnetPosition, peerMagnetPositions, question])\r\n\r\n  // DEBUG-ONLY\r\n  /*useEffect(() => {\r\n    // The component was drawn for the first time, configure a 1-second interval to simulate peer updates\r\n    const interval = setInterval(() => {\r\n      setPeerMagnetPositions(peerPositions => peerPositions.map(\r\n        peerPosition => \r\n          ((question.status === QuestionStatus.Loaded) && (peerPosition.length !== question.answers.length))\r\n          ? new Array(question.answers.length).fill(0).map(_ => Math.random())\r\n          : peerPosition.map(\r\n            value => Math.min(1.1, Math.max(0, value + (Math.random() - 0.5) * 0.1))\r\n          )\r\n      ));\r\n    }, 100);\r\n    return () => clearInterval(interval);\r\n  }, [question]);*/\r\n\r\n  const onUserMagnetMove = (position) => {\r\n    if (sessionStatus !== SessionStatus.Active) return;\r\n    let sumPositions = 0\r\n    for (let i = 0; i < position.norm.length; i++)\r\n      sumPositions += position.norm[i];\r\n    if (sumPositions > 1) {\r\n      for (let i = 0; i < position.norm.length; i++)\r\n        position.norm[i] = position.norm[i] / sumPositions;\r\n    }\r\n    setUserMagnetPosition(position);\r\n    const tiempoTranscurrido = Date.now();\r\n    const hoy = new Date(tiempoTranscurrido);\r\n    sessionRef.current.publishUpdate({ data: { position: position.norm, timeStamp: hoy.toISOString() } });\r\n  };\r\n\r\n  const onLeaveSessionClick = useCallback(() => {\r\n    // TODO: User should double-check the intention to logout (showing a modal when the leave/logout button is pressed)\r\n    // TODO: The server should be notified about the user leaving the session:\r\n    //sessionRef.current.leave()\r\n    fetch(\r\n      `/api/session/${sessionId}/participants/${participantId}`,\r\n      {\r\n        method: 'POST',\r\n        headers: {\r\n          'Accept': 'application/json',\r\n          'Content-Type': 'application/json'\r\n        }\r\n      }\r\n    ).then(res => {\r\n      if (res.status === 200) {\r\n        res.json().then(data => {\r\n        });\r\n      } else {\r\n      }\r\n    }).catch(error => {\r\n    });\r\n    onLeave();\r\n  }, []);\r\n\r\n  return (\r\n    <>\r\n      <Backdrop\r\n        sx={{ color: '#fff', zIndex: (theme) => theme.zIndex.drawer + 1 }}\r\n        open={sessionStatus !== SessionStatus.Active}\r\n      >\r\n        <SessionStatusView\r\n          sessionId={sessionId}\r\n          sessionStatus={sessionStatus}\r\n          questionStatus={question.status}\r\n          onLeaveClick={onLeaveSessionClick}\r\n        />\r\n      </Backdrop>\r\n      <Box\r\n        component=\"main\"\r\n        height='100vh'\r\n        sx={{\r\n          display: 'flex',\r\n          flexDirection: 'column',\r\n        }}\r\n      >\r\n        <Paper\r\n          component=\"header\"\r\n          elevation={2}\r\n          sx={{\r\n            m: 1,\r\n            p: 1,\r\n            borderRadius: 2\r\n          }}\r\n        >\r\n          <Typography component=\"h1\" variant=\"h4\" textAlign='center'>\r\n            {question.status === QuestionStatus.Loaded ? question.prompt : \"Question not defined yet\"}\r\n          </Typography>\r\n        </Paper>\r\n        <Box\r\n          sx={{\r\n            flex: 1,\r\n            minHeight: 0,\r\n            gap: '10px',\r\n            m: 1,\r\n            display: 'flex',\r\n            alignItems: 'stretch',\r\n          }}\r\n        >\r\n          <Paper\r\n            variant=\"outlined\"\r\n            sx={{\r\n              flex: 1, /* grow: 1, shrink: 1, basis: 0*/\r\n              alignSelf: 'flex-start',\r\n              bgcolor: '#EEEEEE',\r\n              p: 1,\r\n            }}\r\n          >\r\n            <QuestionDetails\r\n              image={question.status === QuestionStatus.Loaded ? question.image : \"\"}\r\n              prompt={question.status === QuestionStatus.Loaded ? question.prompt : \"Question not defined yet\"}\r\n            />\r\n            {sessionStatus === SessionStatus.Active && <CountDown targetDate={targetDateCountdown} />}\r\n          </Paper>\r\n          <Paper\r\n            elevation={2}\r\n            sx={{\r\n              flex: 2, // grow: 2, shrink: 2, basis: 0\r\n              height: '100%',\r\n              p: 1,\r\n              display: 'flex',\r\n              flexDirection: 'column',\r\n            }}\r\n          >\r\n            <BoardView\r\n              answers={question.status === QuestionStatus.Loaded ? question.answers : []}\r\n              centralCuePosition={centralCuePosition}\r\n              peerMagnetPositions={peerMagnetPositions && Object.keys(peerMagnetPositions).map(\r\n                k => peerMagnetPositions[k]\r\n              )}\r\n              userMagnetPosition={userMagnetPosition}\r\n              onUserMagnetMove={onUserMagnetMove}\r\n            />\r\n          </Paper>\r\n        </Box>\r\n      </Box>\r\n    </>\r\n  );\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}